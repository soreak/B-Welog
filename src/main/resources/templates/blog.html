<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml" xmlns:sec="http://www.w3.org/1999/xhtml">
<head th:replace="_fragments :: head(~{::title})">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width ,initial-scale=1.0">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/semantic-ui@2.4.2/dist/semantic.min.css">
    <link rel="stylesheet" href="../static/css/typo.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.7.2/animate.min.css">
    <link rel="stylesheet" href="../static/lib/prism/prism.css">
    <link rel="stylesheet" href="../static/lib/tocbot/tocbot.css">
    <link rel="stylesheet" href="../static/css/me.css">
    <title th:text="${blog.title}">åšå®¢è¯¦æƒ…</title>
</head>
<body>
<!--å¯¼èˆª-->
    <!--m è‡ªå®šä¹‰ é—´è· ä¸Šä¸‹ -->
    <nav th:replace="_fragments :: menu(1)" class="ui inverted attached segment m-padded-tb-mini m-shadow-small">
        <div class="ui container">
            <div class="ui inverted secondary stackable menu">
                <h2 class="ui teal header item">Blog</h2>
                <a href="#" class="m-item item m-mobile-hide"><i class="home icon"></i>é¦–é¡µ</a>
                <a href="#" class="m-item item m-mobile-hide"><i class="idea icon"></i>åˆ†ç±»</a>
                <a href="#" class="m-item item m-mobile-hide"><i class="target icon"></i>æ ‡ç­¾</a>
                <a href="#" class="m-item item m-mobile-hide"><i class="clone icon"></i>å½’æ¡£</a>
                <a href="#" class="m-item item m-mobile-hide"><i class="info icon"></i>å…³äºæˆ‘</a>

                <div class="right item m-mobile-hide">
                    <div class="ui icon inverted transparent input">
                        <input type="text" placeholder="Search...">
                        <i class="search link icon"></i>
                    </div>
                </div>
            </div>
        </div>
        <!--menu toggle ç”¨äºjQueryé€‰æ‹©-->
        <!--åŠ äº†menu ä½¿å¾—æŒ‰é’®ä¼šåœ¨å¯¼èˆªæ æ°´å¹³å±…ä¸­ä½ç½®-->
        <a href="#" class="ui menu toggle black icon button m-right-top m-mobile-show">
            <i class="sidebar icon"></i>
        </a>

    </nav>
<!--ä¸­é—´å†…å®¹-->
    <div id="waypoint" class="m-container-small m-padded-tb-big animated fadeIn">
        <!--container å“åº”ç§»åŠ¨ç«¯-->
        <div class="ui container">
            <!--top attached ä¸Šé¢æ˜¯åœ†è§’ ä¸‹é¢å¯ä»¥ä¸ä¸‹æ–¹æ‹¼æ¥-->
            <!--å¤´éƒ¨-->
            <div class="ui top attached segment">
                <div class="ui horizontal link list">
                    <div class="item">
                        <img src="http://lorempixel.com/100/100/" th:src="@{${blog.userAvatar}}" alt="" class="ui avatar image">
                        <div class="content"><a href="#" class="header" th:text="${blog.userName}">soreaK</a></div>
                    </div>
                    <div class="item">
                        <i class="calendar icon" ></i><span th:text="${#dates.format(blog.updateTime,'yyyy-MM-dd')}">2020-8-6</span>
                    </div>
                    <div class="item">
                        <i class="eye icon"></i><span th:text="${blog.views}">2333</span>
                    </div>
                </div>

            </div>
            <!--å†…å®¹-->
            <div class="ui attached padded segment">
                <!--basic å»æ‰segmentå¤–éƒ¨çš„æ¡†æ¡†-->
                <div class="ui right aligned basic segment">
                    <div class="ui orange basic label" th:text="${blog.flag}">è½¬è½½</div>
                </div>
                <h2 class="ui center aligned header" th:text="${blog.title}">éæš´åŠ›æ²Ÿé€š</h2>
                <br>
                <div id="content" class="typo typo-selection js-toc-content m-padded-lr-response m-padded-tb-large" th:utext="${blog.content}">
                    <p>ä¹Ÿè®¸æˆ‘ä»¬å¹¶ä¸è®¤ä¸ºè‡ªå·±çš„è°ˆè¯æ–¹å¼æ˜¯æš´åŠ›çš„ï¼Œä½†æˆ‘ä»¬çš„è¯­è¨€ç¡®å®å¸¸å¸¸å¼•å‘è‡ªå·±å’Œä»–äººçš„ç—›è‹¦</p>
                    <p>â€”â€”é©¬æ­‡å°”Â·å¢æ£®å ¡ ã€Šéæš´åŠ›æ²Ÿé€šã€‹</p>
                    <br>
                    <pre><code class="language-css"> p {color: red}</code></pre>
                    <p>å‰æ®µæ—¶é—´çœ‹äº†ä¸€äº›è®²è¿°â€œæš´åŠ›æ²Ÿé€šâ€çš„æ–‡ç« å’Œè§†é¢‘ï¼Œå¾ˆæœ‰æ„Ÿè§¦ã€‚åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¾ˆå®¹æ˜“è¢«æƒ…ç»ªæ‰€ä¸»å¯¼ï¼Œè¯•å›¾ç”¨æš´åŠ›æ²Ÿé€šè§£å†³é—®é¢˜ï¼Œä½†æ˜¯é—®é¢˜æ€»ä¼šè¶Šæ¥è¶Šç³Ÿç³•ï¼Œç­‰ç¼“è¿‡ç¥æ¥ï¼Œå·²ç»è¯´äº†ä¼¤å®³äººçš„è¯ï¼Œåªèƒ½åæ‚”</p>
                    <h2 id="section1">hello</h2>
                    <h2 id="section2">world</h2>
                    <h2 id="section3">world</h2>
                    <br>
                    <p>è¢«æåŠæ¯”è¾ƒå¤šçš„è§£å†³æ–¹æ³•éƒ½æ˜¯æ¥è‡ªé©¬æ­‡å°”Â·å¢æ£®å ¡çš„<a href="https://book.douban.com/subject/3533221/" target="_blank" rel="noopener">ã€Šéæš´åŠ›æ²Ÿé€šã€‹</a>ï¼Œè¿™æœ¬ä¹¦æå‡ºäº†åŒ–è§£æš´åŠ›æ²Ÿé€šçš„æ–¹æ³•ï¼Œä¸»è¦åˆ†ä¸ºå››ä¸ªæ­¥éª¤ï¼š1. é™ˆè¿°äº‹å®ï¼ˆä¸è¦æºæ‚è‡ªå·±è¿‡æ¿€çš„è¡¨è¾¾ï¼‰ 2. è¡¨è¾¾æ„Ÿå— 3.è¯´å‡ºå“ªäº›éœ€æ±‚å¯¼è‡´äº†è¿™æ ·çš„æ„Ÿå— 4. æå‡ºè¯·æ±‚</p>
                    <p>åœ¨å®é™…çš„ç”Ÿæ´»ä¸­æˆ‘ä»¬å¯èƒ½å¹¶ä¸ä¼šæŒ‰ç…§è¿™æ ·çš„æ¨¡æ¿æ¥è¯´è¯ï¼Œè¿™æ ·å¥—å…¬å¼è¯´å‡ºæ¥çš„è¯åè€Œæ€ªæ€ªçš„ã€‚ä½†æ˜¯è¿™ä¸ªæ–¹æ³•ä¹Ÿç»™æˆ‘ä»¬å¾ˆå¤§çš„å¯å‘ï¼šè¡¨è¾¾çš„æ—¶å€™é™ˆè¿°äº‹å®ï¼Œä¸è¦æºæ‚è‡ªå·±çš„è§‚ç‚¹å’Œè¿‡æ¿€è¨€è¯­ã€‚å¾ˆå¯èƒ½ä¸€å¼€å§‹åªæ˜¯ä¸€ä¸ªå°é—®é¢˜ï¼Œå› ä¸ºæ²¡æœ‰æ­£ç¡®æ²Ÿé€šï¼Œå‡çº§ä¸ºäº†æš´åŠ›æ²Ÿé€šï¼Œä¸¤æ–¹éƒ½å†²æ˜äº†å¤´è„‘ï¼Œæ¥ç€ç¿»å‡ºäº†å„ç§å„æ ·çš„å¾€äº‹ï¼Œä¸¤ä¸ªäººäº’ç›¸ä¼¤å®³ï¼Œè¿˜ä¸æ–­åœ°åŠ ç ã€‚å¦‚æœæˆ‘ä»¬èƒ½å¯¹è¿™æ ·çš„æƒ…å†µæœ‰ä¸€ä¸ªæ¦‚å¿µï¼Œé‚£ä¹ˆæˆ‘ä»¬è‡³å°‘åœ¨ä¸€å¼€å§‹å°±å¯ä»¥é‡è§†è¡¨è¾¾å®¢è§‚äº‹å®å’Œè‡ªå·±çš„æ„Ÿå—</p>
                    <p>è§‚å¯Ÿåˆ°çš„æƒ…å†µï¼šåœ¨é¢å¯¹æ²¡é‚£ä¹ˆäº²è¿‘çš„äººæˆ–è€…æ˜¯é™Œç”Ÿäººçš„æ—¶å€™å¿ƒæ€å¾ˆå¹³å’Œï¼Œåè€Œåœ¨ä¸€äº›ç‰¹å®šçš„æƒ…å†µä¸‹é¢å¯¹æ¯”è¾ƒäº²è¿‘çš„äººï¼ˆæ¯”å¦‚æˆ‘ä»¬çš„çˆ¶æ¯ï¼‰çš„æ—¶å€™å¸¦ç€ç‚¹æˆ¾æ°”ã€‚åœ¨è¿™äº›æƒ…å†µä¸‹å¾ˆéš¾æ”¾ä¸‹æƒ…ç»ªè¡¨è¾¾å®¢è§‚äº‹å®å’Œè‡ªå·±çš„æ„Ÿå—ï¼Œè¿™ä¸ªæ—¶å€™æˆ–è®¸å¯ä»¥å…ˆä¸ç€æ€¥æ²Ÿé€šï¼Œå…ˆå†·é™ï¼Œæƒ³æƒ³å¯¹æ–¹çš„ä¸æ˜“ï¼Œå°è¯•å»åŒ–è§£å¯¹æ–¹è¯´çš„è¯ï¼Œ<strong>æŠŠå¯¹æ–¹çš„æš´åŠ›æ²Ÿé€šè½¬åŒ–ä¸ºä¸Šé¢çš„4ä¸ªæ­¥éª¤</strong>ï¼Œç»å†äº†è¿™ä¸ªè¿‡ç¨‹äº‹æƒ…æ€»ä¼šæ…¢æ…¢å˜å¥½ã€‚å’Œå…¶ä»–çš„ç†è®ºä¸€æ ·ï¼ŒçŸ¥é“äº†å¹¶ä¸ä¼šæ”¹å˜ä»€ä¹ˆï¼Œè¿˜éœ€è¦åœ¨å®è·µä¸­ç£¨åˆç†è®ºï¼Œå…‹åˆ¶æœ¬èƒ½çš„ååº”ï¼Œä¸€å¼€å§‹å¯èƒ½è¿˜æ˜¯ä¸€å›¢ç³Ÿï¼Œä½†æ˜¯æ…¢æ…¢åœ°æ²Ÿé€šå°±ä¼šè¶Šæ¥è¶Šå¹³é¡º</p>
                    <br>

                    <p>è±†ç“£è¯»ä¹¦ï¼š<a href="https://book.douban.com/subject/3533221/" target="_blank" rel="noopener">éæš´åŠ›æ²Ÿé€š</a></p>
                    <p>çŸ¥ä¹ç›¸å…³é—®ç­”ï¼š<a href="https://www.zhihu.com/question/20613214" target="_blank" rel="noopener">å¦‚ä½•è¯„ä»·ã€Šéæš´åŠ›æ²Ÿé€šã€‹è¿™æœ¬ä¹¦ï¼Ÿ</a></p>
                    <p>æœ€åæ¨èä¸€éƒ¨è¿˜è›®æœ‰æ„æ€çš„è·Ÿæ²Ÿé€šç›¸å…³çš„çŸ­ç‰‡<a href="https://www.bilibili.com/video/BV187411m7zb" target="_blank" rel="noopener">ã€Šé™éŸ³ã€‹</a></p>
                </div>
                <!--æ ‡ç­¾-->
                <div class="m-padded-lr-response">
                    <div class="ui basic teal left pointing label" th:each="tag : ${blog.tags}" th:text="${tag.name}">é›¶ç¢</div>
                </div>
                <!--ç‚¹èµ-->
                <div style="text-align: center" th:switch="${BlogLikeFlag}" sec:authorize="isAuthenticated()">
                    <div th:case="0" >
                        <input type="hidden" name="likeStyle" value="-1">
                        <button class="ui toggle button ">ğŸ‘</button>
                    </div>
                    <div th:case="1">
                        <input type="hidden" name="likeStyle" value="1">
                        <button class="ui toggle button orange">ğŸ‘</button>
                    </div>

                </div>
            </div>

            <!--ç•™è¨€åŒºåŸŸ-->
            <div  class="ui bottom attached segment" th:if="${blog.commentabled}">
                <!--ç•™è¨€åˆ—è¡¨-->
                <div id="comment-container" class="ui teal segment">
                    <div th:fragment="blogCommentList">
                        <div class="ui threaded comments" style="max-width: 100%;">
                            <h3 class="ui dividing header">è¯„è®º</h3>
                            <div class="comment" th:if="${#lists.isEmpty(comments)}">
                                <span>ç©ºç©ºå¦‚ä¹Ÿ,å¿«æ¥è¯„è®ºå§</span>
                            </div>
                            <div class="comment" th:each="comment : ${comments}">
                                <div class="content">
                                    <a class="author">
                                        <span th:text="${comment.nickname}">Matt</span>
                                        <div class="ui mini basic teal left pointing label m-padded-mini" th:if="${comment.userId} eq ${authorId}">åšä¸»</div>
                                    </a>
                                    <div class="metadata">
                                        <span class="date" th:text="${#dates.format(comment.createTime,'yyyy-MM-dd HH:mm')}">Today at 5:42PM</span>

                                        <i sec:authorize="isAuthenticated()" th:if="${authorFlag} eq 'true'" th:attr="data-commentid=${comment.id}" class="close icon button" onclick="deleteContent(this)"></i>


                                    </div>
                                    <div class="text" th:text="${comment.content}">
                                        How artistic!
                                    </div>
                                    <div class="actions">
                                        <a class="reply" one-link-mark="yes" data-commentid="1" data-commentnickname="Matt" th:attr="data-commentid=${comment.id},data-commentnickname=${comment.nickname}" onclick="reply(this)">å›å¤</a>
                                    </div>
                                </div>
                                <div class="comments" th:if="${#arrays.length(comment.replyComments)}>0">
                                    <div class="comment" th:each="reply : ${comment.replyComments}">
                                        <div class="content">
                                            <a class="author" ><span th:text="${reply.nickname}"> Matt</span>
                                              <div class="ui mini basic teal left pointing label m-padded-mini" th:if="${reply.userId} eq ${authorId}">åšä¸»</div>
                                                &nbsp;
                                                <span th:text="|@ ${reply.parentComment.nickname}|" class="m-teal">@ xiaobai</span></a>
                                            <div class="metadata">
                                                <span class="date" th:text="${#dates.format(reply.createTime,'yyyy-MM-dd HH:mm')}">Today at 5:42PM</span>
                                                <i sec:authorize="isAuthenticated()" th:if="${authorFlag} eq 'true'" th:attr="data-commentid=${reply.id}" class="close icon button" onclick="deleteContent(this)"></i>
                                            </div>
                                            <div class="text" th:text="${reply.content}">
                                                How artistic!
                                            </div>
                                            <div class="actions">
                                                <a class="reply" one-link-mark="yes" data-commentid="1" data-commentnickname="Matt" th:attr="data-commentid=${reply.id},data-commentnickname=${reply.nickname}" onclick="reply(this)">å›å¤</a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>

                </div>
                <!--ui form è¡¨æ ¼æ ·å¼-->
                <div id="comment-form" class="ui form">
                    <input type="hidden" name="blog.id" th:value="${blog.id}">
                    <input type="hidden" name="parentComment.id" th:value="-1">



                    <div sec:authorize="!isAuthenticated()">
                        <div class="field">
                            <textarea name="content" placeholder="è¯·ç™»å½•..."  cols="30" rows="10" readonly="readonly"></textarea>
                        </div>
                        <div class="fields">
                            <div class="field m-mobile-wide margin-bottom-small">
                                <a href="#" class="ui teal button" th:href="@{/login}">ç™»å½•</a>
                            </div>

                        </div>
                    </div>


                    <div sec:authorize="isAuthenticated()">
                        <div class="field">
                            <textarea name="content" placeholder="è¯·è¾“å…¥è¯„è®ºä¿¡æ¯..."  cols="30" rows="10"></textarea>
                        </div>
                        <div class="fields">
                            <div class="field m-mobile-wide margin-bottom-small">
                                <button type="button" id="commentpost-btn" class="ui teal m-mobile-wide button"> <i class="edit icon"></i>å‘å¸ƒ</button>
                            </div>

                        </div>
                    </div>
                </div>

                <!--ui model-->
                <div class="ui tiny modal">
                    <input type="hidden" name="idBlog" th:value="${blog.id}">
                    <input type="hidden" name="commentId" th:value="-1">
                    <div class="header">åˆ é™¤è¯„è®º</div>
                    <div class="content">
                        <p>ä½ ç¡®å®šåˆ é™¤è¯„è®ºå—</p>
                    </div>
                    <div class="actions">
                        <div class="ui cancel button">å–æ¶ˆ</div>
                        <div class="ui green button" onclick="deleteComment()">ç¡®è®¤åˆ é™¤</div>
                    </div>
                </div>
            </div>
        </div>
    </div>




    <div id="toolbar" class="m-padded m-fixed m-right-bottom" style="display: none">
        <div class="ui vertical icon buttons">
            <button type="button" class="ui toc teal button">ç›®å½•</button>
            <a href='#comment-container' type="button" class="ui teal button">ç•™è¨€</a>
            <div id="toTop-button" class="ui icon button"><i class="chevron up icon"></i></div>
        </div>
    </div>

    <div class="ui toc-container flowing popup transition hidden" style="width: 250px !important;">
        <!--ç”Ÿæˆç›®å½•-->
        <ol class="js-toc"></ol>
    </div>





<!--/*/<th:block th:replace="_fragments :: script">/*/-->
<script src="https://cdn.jsdelivr.net/npm/jquery@3.2/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/semantic-ui@2.4.2/dist/semantic.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jquery.scrollto@2.1.2/jquery.scrollTo.min.js"></script>
<script src="../static/lib/prism/prism.js"></script>
<script src="../static/lib/tocbot/tocbot.min.js"></script>
<script src="../static/lib/qrcode/qrcode.min.js"></script>
<script src="../static/lib/waypoints/jquery.waypoints.min.js"></script>
<!--/*/</th:block>/*/-->
<script th:inline="javascript">

    tocbot.init({
        // Where to render the table of contents.
        tocSelector: '.js-toc',
        // Where to grab the headings to build the table of contents.
        contentSelector: '.js-toc-content',
        // Which headings to grab inside of the contentSelector element.
        headingSelector: 'h1, h2, h3',
        // For headings inside relative or absolute positioned containers within content.
        hasInnerContainers: true,
    });

    $('.toc.button').popup( {
        popup : $('.toc-container.popup'),
        on : 'click',
        position : 'left center'
    });

    $('#toTop-button').click(function () {
        /*0 æœ€å¼€å¤´ 500 é—´éš”æ—¶é—´*/
        $(window).scrollTo(0,500);
    });

    var waypoint = new Waypoint({
        element: document.getElementById('waypoint'),
        handler: function(direction) {
            // console.log('Scrolled to waypoint!')
            if(direction == 'down'){
                $('#toolbar').show(500);
            }else{
                $('#toolbar').hide(500);
            }
        }
    })


    /*è¡¨å•æ•°æ®æ ¡éªŒ*/
    $('.ui.form').form({
        fields : {
            title : {
                identifier : 'content',
                rules : [{
                    /*éç©ºæ ¡éªŒ*/
                    type : 'empty',
                    prompt : 'è¯·è¾“å…¥è¯„è®ºå†…å®¹'

                }]
            },
        }
    });

    $('#commentpost-btn').click(function () {
        var boo = $('.ui.form').form('validate form');
        if (boo){
            console.log('æ ¡éªŒæˆåŠŸ');
            postData();
        }else {
            console.log('æ ¡éªŒå¤±è´¥');
        }
    });

    $('.ui.toggle.button').click(function() {
        like()
        if ($("[name='likeStyle']").val() == -1) {
            $('.ui.toggle.button').addClass("orange");
            $("[name='likeStyle']").val(1);
        } else {
            $('.ui.toggle.button').removeClass("orange");
            $("[name='likeStyle']").val(-1);

        }
    });



    // é¡µé¢åŠ è½½å®ŒæˆååŠ è½½è¯„è®º
    $(function () {
        ($('#comment-container').load(/*[[@{/blogComments/{id}(id=${blog.id})}]]*/"blogComments/0"));
    });

    function postData() {
        $("#comment-container").load(/*[[@{/blogComments}]]*/"",{
            "parentCommentId" : $("[name='parentComment.id']").val(),
            "blogId" : $("[name='blog.id']").val(),
            "content" : $("[name='content']").val(),
        },function (responseTxt,statusTxt,xhr) {
            // $(window).scrollTo($('#comment-container'),500);
            clearContent();
        });
    }

    function deleteContent(obj) {
        var commentId = $(obj).data('commentid');
        $("[name='commentId']").val(commentId);
        $('.tiny.modal')
            .modal('show')
        ;
    }


    function deleteComment() {
        $("#comment-container").load(/*[[@{/blogComments/delete}]]*/"",{
            "id" : $("[name='commentId']").val(),
            "blogId" : $("[name='idBlog']").val(),
        },function (responseTxt,statusTxt,xhr) {
            $('.tiny.modal')
                .modal('hide')
            ;
        });
    }

    function like() {
        $.ajax({
            type: "POST",
            url: "/BlogLike",
            data: {
                blogId: $("[name='blog.id']").val(),
                likeStyle: $("[name='likeStyle']").val(),
            },
            success:function (data) {
                console.log(data.status);
            }
        });
    }


    function clearContent() {
        $("[name='content']").val('');
        $("[name='parentComment.id']").val(-1);
        $("[name='content']").attr("placeholder","è¯·è¾“å…¥è¯„è®ºä¿¡æ¯....");

    }

    function reply(obj) {
        var commentId = $(obj).data('commentid');
        var commentNickname = $(obj).data('commentnickname');
        $("[name='content']").attr("placeholder","@"+commentNickname).focus();
        $("[name='parentComment.id']").val(commentId);
        $(window).scrollTo($('#comment-form'),500);
    }




</script>
</body>
</html>